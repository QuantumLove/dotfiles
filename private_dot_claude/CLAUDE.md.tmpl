# Personal Preferences

## Coding Philosophy

### Backwards Compatibility
- **Default:** Don't worry about backwards compatibility unless explicitly stated
- **When relevant:** Flag real concerns in plans and during code review
- **Action:** Without explicit confirmation, code as if backwards compatibility is not a concern
- **Exception:** If a change would break critical production systems or public APIs, flag it before proceeding

### General Approach
- Prefer simple, direct solutions over defensive/future-proof abstractions
- Delete unused code rather than commenting it out or adding deprecation shims
- When in doubt, ask rather than over-engineer

### Code Comments
- Only add comments when logic isn't self-evident
- Don't add docstrings, comments, or type annotations to unchanged code
- Readable code is better than commented code

## Terraform/Infrastructure Safety

**CRITICAL:** These rules prevent production incidents. Always check before applying TF changes.

### Resource Moves (STOP before destroying + creating)
When TF plan shows "destroy" + "create" for similar resources:
- **This is likely a resource move** that needs handling before apply
- Moving resources in TF files WITHOUT proper handling = recreation = **downtime**
- Pattern to detect: same resource type being destroyed and created with similar names

**Two safe approaches (prefer moved blocks):**
1. **Moved blocks (preferred)** - Add to TF code, no manual state commands:
   ```hcl
   moved {
     from = aws_ecs_service.api
     to   = aws_ecs_service.api_service
   }
   ```
2. **State mv** - Manual command before apply:
   ```bash
   tofu state mv "old_addr" "new_addr"
   ```

### Permission/IAM Changes (Check running workloads)
When changing IAM roles, policies, or permissions:
- **Ask:** "Which running workloads use this role/policy?"
- **Check:** `aws iam list-entities-for-policy` or `get-role` to see attachments
- **Risk:** Existing workloads may lose permissions immediately while new workloads work fine
- **Safe pattern:** Add new permissions first, migrate workloads, then remove old permissions

### Stateful Resources (Extra caution)
Before destroying databases, S3 buckets, EFS, or persistent volumes:
- Verify backups exist and are recent
- Confirm data migration is complete
- Check for `prevent_destroy` lifecycle rules
- These are often **unrecoverable** if destroyed

### Review Checklist for TF PRs
1. [ ] Any destroy+create pairs? → Check if `state mv` needed
2. [ ] IAM/permission changes? → List affected running workloads
3. [ ] Stateful resource changes? → Verify backup/migration plan
4. [ ] Production workspace? → Extra scrutiny required

## Chezmoi Management

This Claude configuration is managed by chezmoi.
- **Source:** ~/.local/share/chezmoi/private_dot_claude/
- **Applied:** ~/.claude/
- **Apply changes:** `chezmoi apply`
- **See diff:** `chezmoi diff`
- **Backup/restore:** Just use git on the chezmoi source directory

### When to Edit Chezmoi (not the current repo)

If fixing personal tooling that spans projects, edit chezmoi source instead:

| Issue type | Edit chezmoi source |
|------------|---------------------|
| Shell functions (`~/.sh_functions`) | `~/.local/share/chezmoi/dot_sh_functions.tmpl` |
| Warp configs | `~/.local/share/chezmoi/dot_warp/` |
| Claude global settings | `~/.local/share/chezmoi/private_dot_claude/` |
| Zsh/Bash config | `~/.local/share/chezmoi/dot_zshrc.tmpl` |

**Workflow:** Edit source → `chezmoi apply` → test → commit to chezmoi repo
