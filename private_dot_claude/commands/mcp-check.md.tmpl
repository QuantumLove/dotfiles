---
name: mcp-check
description: Check MCP server authentication status
---

# MCP Authentication Check

Verify that all MCP servers can authenticate from current environment.

## Usage

```
/mcp-check
/mcp-check --verbose
```

## Implementation

```bash
echo "ğŸ” Checking MCP Authentication..."
echo ""

# Check required credentials
if [ -n "$LINEAR_API_KEY" ]; then
    # Mask the token (show first 4 and last 4 chars)
    masked="${LINEAR_API_KEY:0:4}...${LINEAR_API_KEY: -4}"
    echo "âœ… Linear API Key: $masked"
else
    echo "âŒ Linear API Key: Not set (LINEAR_API_KEY)"
fi

# Check gh CLI authentication (used by gh CLI, not MCP)
if command -v gh &> /dev/null; then
    if gh auth status &> /dev/null; then
        gh_user=$(gh api user --jq '.login' 2>/dev/null)
        echo "âœ… gh CLI: Authenticated as $gh_user (keyring)"
    else
        echo "âŒ gh CLI: Not authenticated (run: gh auth login)"
    fi
else
    echo "âš ï¸  gh CLI: Not installed"
fi

# GitHub MCP uses OAuth (no env variable needed)
echo "â„¹ï¸  GitHub MCP: Uses OAuth (browser authorization on first use)"

echo ""
echo "ğŸ“¡ Testing MCP Connections..."

# Test Linear API (cache response to avoid duplicate API call)
if [ -n "$LINEAR_API_KEY" ]; then
    linear_response=$(curl -s -H "Authorization: $LINEAR_API_KEY" \
        https://api.linear.app/graphql \
        -H "Content-Type: application/json" \
        -d '{"query":"{ viewer { id name } }"}' 2>/dev/null)
    if echo "$linear_response" | jq -e '.data.viewer.name' > /dev/null 2>&1; then
        linear_user=$(echo "$linear_response" | jq -r '.data.viewer.name')
        echo "âœ… Linear API: Connected as $linear_user"
    else
        echo "âŒ Linear API: Authentication failed"
    fi
fi

# Check environment
echo ""
echo "ğŸ“ Environment:"
if [ -n "$CODESPACES" ]; then
    echo "   Location: GitHub Codespaces"
elif [ -n "$REMOTE_CONTAINERS" ]; then
    echo "   Location: DevContainer"
elif [ -n "$TERM_PROGRAM" ] && [ "$TERM_PROGRAM" = "WarpTerminal" ]; then
    echo "   Location: Warp (macOS host)"
else
    echo "   Location: macOS host"
fi

# Final status
echo ""
if [ -n "$LINEAR_API_KEY" ] && command -v gh &> /dev/null && gh auth status &> /dev/null; then
    echo "âœ… All MCP servers ready!"
    echo "   â€¢ Linear MCP: Using LINEAR_API_KEY"
    echo "   â€¢ GitHub MCP: Will use OAuth on first use"
    echo "   â€¢ gh CLI: Using keyring authentication"
else
    echo "âš ï¸  Some services need configuration:"
    [ -z "$LINEAR_API_KEY" ] && echo "   â€¢ Run: /mcp-setup-1password (for LINEAR_API_KEY)"
    if ! command -v gh &> /dev/null || ! gh auth status &> /dev/null; then
        echo "   â€¢ Run: gh auth login (for gh CLI)"
    fi
fi
```

## Example Output

```
ğŸ” Checking MCP Authentication...

âœ… Linear API Key: lin_...xyz
âœ… GitHub Token: ghp_...abc

ğŸ“¡ Testing MCP Connections...
âœ… GitHub API: Connected (rafaelcarvalho)

ğŸ“ Environment:
   Location: DevContainer

âœ… All MCP servers authenticated successfully!
```
